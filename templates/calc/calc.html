{% extends "base.html" %}
{% block site_wrapper %}

<script type="text/javascript">
	
	var current_type;
	
	var moveto_step	= function(current_index){
	
		$('#calc_block').find('.progressbar').find('li').eq(current_index+1).addClass('current').prev().addClass('success').removeClass('current');
				
		var	step_width	= $('#calc_steps_form').width()	
		
		var left_slide	= -$('.calc_step').width()*(current_index+1);

		$('#calc_steps_form').animate( { marginLeft : left_slide+'px' } );
		
	};
	
	var next_step	= function(event){
		
		if($(event).parent().hasClass('ready')){
		
			var current_index	= $(event).parent().index();
			
			moveto_step(current_index);	
			
		}
	};
	
	var prev_step	= function(event){
		
		var current_index	= $(event).parent().index();
				
		$('#calc_block').find('.progressbar').find('li').eq(current_index-1).addClass('current').next().removeClass('current');
		
		var	step_width	= $('#calc_steps_form').width()	
		
		var left_slide	= -$('.calc_step').width()*(current_index-1);

		$('#calc_steps_form').animate( { marginLeft : left_slide+'px' } );
	};
	
	var goto_step	= function(event){
		
		var current_index	= $(event).index();
		
		if($(event).hasClass('success')){
			
			$('#calc_block').find('.progressbar').find('.current').removeClass('current');
			
			$(event).addClass('current');
			
			var	step_width	= $('#calc_steps_form').width()	
		
			var left_slide	= -$('.calc_step').width()*(current_index);
	
			$('#calc_steps_form').animate( { marginLeft : left_slide+'px' } );
			
		}
		
	}
	
	$(function(){
		
		$('#calc_block').find('.calc_step').find('input[type="radio"]').live('change',function(){
			
			$(this).parents('.calc_step').addClass('ready');
			
		});
		
		$('#calc_step_1').find('input[type="radio"]').live('change',function(){
			
			current_type	=	$(this).val();
			
		});
		
		var current_location;
		
		$('.location_select').live('change', function(){
		
			var $this	= $(this);
			
			if(current_type === 'IP'){
				
				$this.parent().next().children().hide().end().next().addClass('onload');
						
				var	data_send	= {type: current_type, location: $this.val()};
				var url			= 'ajx-api';
				
				$.ajax({
					type:	"POST",
					url:	url,
					data:	data_send,
					complete:	function(data){
						
						$this.parent().next().next().removeClass('onload').html('Разрешение: <select class="resolution_select" name="resolution[]"><option disabled="disabled" selected="selected"></option><option value="1">640x480</option><option value="2">1024x768</option><option value="3">1280x1020</option></select>');
						
					}
				});
				
			}else{
			
				$this.parent().next().children().show();
				
			}
		});	
		
		$('.color_select').live('change', function(){
		
			var $this	= $(this);
			
			$this.parent().next().addClass('onload');
			
			var	data_send	= {type: current_type, location: $this.parent().prev().find('.location_select').val(), color: $this.val()};
			
			var url			= 'ajx-api';
			
			$.ajax({
				type:	"POST",
				url:	url,
				data:	data_send,
				complete:	function(data){
					
					$this.parent().next().removeClass('onload').html('Разрешение: <select class="resolution_select" name="resolution[]"><option disabled="disabled" selected="selected"></option><option value="1">640x480</option><option value="2">1024x768</option><option value="3">1280x1020</option></select>');
					
				}
			});
			
		});
		
		$('.resolution_select').live('change', function(){
		
			var $this	= $(this);
			
			$this.parent().next().children().show();
					
			
		});
		
		var $cams_select_table	= $('#cams_select_table');
		
		$('#add_cam_link').live('click', function(e){
			
			e.preventDefault();
			
			var col_num = $('#cams_select_table').find('tr').size()+1;
			$cams_select_table.append('<tr><td class="num">'+col_num+'</td><td><select class="location_select" name="location[]"><option disabled selected="selected">Тип камеры</option><option value="1">Внутренняя</option><option value="2">Внешняя</option></select></td><td class="color_block"><select class="color_select" name="color[]" style="display:none;"><option disabled selected="selected">Цвет</option><option value="1">Цветная</option><option value="2">Черно-белая</option></select></td><td class="resolution_block"></td><td class="count_block"><label style="display:none;">Количество: <input type="text" value="1"></label></td><td><a href="#" class="remove_cam_link">Удалить</a></td></tr>');
		});
		
		$('.remove_cam_link').live('click', function(e){
			
			e.preventDefault();
			
			$(this).parent().parent().remove();
			
			$cams_select_table.find('tr').each(function(index){
				$(this).children('.num').text(index+1);
			});
			
		});
		
		$('.mounting_block').find('input').live('change',function(){
			if($(this).attr('checked')){
				$(this).parent().parent().next().show().removeAttr('disabled');
			}else{
				$(this).parent().parent().next().hide().attr('disabled','disabled');
			}
		});
		
	});

</script>

<div id="content_block">
	<div id="content">
	
		<section id="calc_block">
			<nav class="">
				<ul class="progressbar clearfix">
					<li class="current" onclick="goto_step(this); return false;"><span class="num">1</span>IP/Аналог</li>
					<li onclick="goto_step(this); return false;"><span class="num">2</span>Тип системы</li>
			        <li onclick="goto_step(this); return false;"><span class="num">3</span>Камеры/Регистратор</li>
			        <li onclick="goto_step(this); return false;"><span class="num">4</span>Монтаж</li>
			        <li onclick="goto_step(this); return false;"><span class="num">5</span>Результат</li>
				</ul>
			</nav>
			<form id="calc_steps_form" action="" method="post" class="clearfix" autocomplete="off">
				<article id="calc_step_1" class="calc_step clearfix">
					<hr>
					<h2>Тип системы</h2>
					<p><label><input type="radio" name="type" value="IP"> IP</label></p>
					<p><label><input type="radio" name="type" value="ANALOG"> Аналог</label></p>
					<hr>
					<button class="alignright" onclick="next_step(this); return false;">Дальше</button>
				</article>
				<article id="calc_step_2" class="calc_step clearfix">
					<hr>
					<h2>Класс системы</h2>
					<p><label><input type="radio" name="class" value="1"> Бюджетное решение</label></p>
					<p><label><input type="radio" name="class" value="2"> Система среднего уровня</label></p>
					<p><label><input type="radio" name="class" value="3"> Профессиональные системы</label></p>
					<hr>
					<button class="alignleft" onclick="prev_step(this); return false;">Назад</button>
					<button class="alignright" onclick="next_step(this); return false;">Дальше</button>
				</article>
				<article id="calc_step_3" class="calc_step clearfix">
					<hr>
					<h2>Срок хранения архива</h2>
						<div>
							<p><label><input type="radio" name="archive" value="1"> До 2х недель</label></p>
							<p><label><input type="radio" name="archive" value="2"> До 4х недель</label></p>
						</div>
					<hr>
					<h2>Выберите камеры</h2>
					<table id="cams_select_table" class="base_table table-striped">
						<tr>
							<td class="num">1</td>
							<td>
								<select class="location_select" name="location[]">
									<option disabled selected="selected">Тип камеры</option>
									<option value="1">Внутренняя</option>
									<option value="2">Внешняя</option>
								</select>
							</td>
							<td class="color_block">
								<select class="color_select" name="color[]" style="display:none;">
									<option disabled selected="selected">Цвет</option>
									<option value="1">Цветная</option>
									<option value="2">Черно-белая</option>
								</select>
							</td>
							<td class="resolution_block">
								
							</td>
							<td class="count_block"><label style="display:none;">Количество: <input type="text" value="1"></label></td>
							<td></td>
						</tr>
					</table>
					<a href="#" id="add_cam_link">+ Добавить камеру</a>
					<hr>
						<div class="mounting_block"><label><input type="checkbox" name="mounting"> Заказать монтаж</label></div>
						<div class="mounting_size" style="display:none;"><label>Укажите метраж: <input type="text" name="m_size" value="10"></label></div>
					<hr>
					<button class="alignleft" onclick="prev_step(this); return false;">Назад</button>
					<button class="alignright" onclick="next_step(this); return false;">Дальше</button>
				</article>
			</form>
		</section>
	
	</div>
</div>

<hr/>
<div class="content">
    <div class="menu">
        <a href="">IP/Аналог</a><br>
        <a href="">Тип системы</a><br>
        <a href="">Камеры/Регистратор</a><br>
        <a href="">Монтаж</a><br>
        <a href="">Результат</a><br>
    </div>
</div>
    <div class='first-step'><b>Выберите IP или Аналог:</b><Br>
        <input type="radio" name="standart" value="IP"> IP<Br>
        <input type="radio" name="standart" value="ANALOG"> Analog<Br>
    <a href="#" id="next1">Далее</a>
    </div>
    <div class='second-step hide'><b>Выберите тип системы:</b><Br>
        <input type="radio" name="type" value="cheap">Бюджетное решение<Br>
        <input type="radio" name="type" value="middle">Системы среднего уровня<Br>
        <input type="radio" name="type" value="pro">Профессиональная система<Br>
    <a href="#" id="next2">Далее</a>
    </div>
    <div class='third-step hide'><b>Выберите камеры:</b><Br>
        Срок хранения архива
        <input type="radio" name="archive" value="cheap">До 2х недель<Br>
        <input type="radio" name="archive" value="midle">До 4х недель<Br>
        <div class="ip-cheap">
            Тип
            <select>
                <option>Внешняя</option>
                <option>Внутренняя</option>
            </select>
            <span class='resolition'>Разрешение</span>
            Количество
            <input type="text" name="count">
        </div>
        <a href="#" id="add">Добавить камеру</a>
        <a href="#" id="next3">Далее</a>
    </div>

{% endblock %}